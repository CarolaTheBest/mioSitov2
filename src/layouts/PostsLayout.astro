---
import TopBar from "../components/topBar/topBar.astro";
import Layout from "./Layout.astro";
import fs from "fs";
import moment from "moment";
import { SideBarHeadings } from "../components/sideBarHeading/sideBarHeadings";
import TabellaSimboli from "../components/tabellaSimboli.astro";

const astroProps = Astro.props;
moment.locale("it");

let ultimaModificaDate = fs.statSync(astroProps.file).mtime;

const ultimaModifica = moment(ultimaModificaDate).format("DD MMMM YYYY");

const titolo: string = astroProps.headings.filter((titolo: any) => titolo.depth == 1)[0].text;
---

<link
  rel="stylesheet"
  href="https://cdn.jsdelivr.net/npm/katex@0.16.2/dist/katex.min.css"
  integrity="sha384-bYdxxUwYipFNohQlHt0bjN/LCpueqWz13HufFEV1SUatKs1cm4L6fFgCi1jT643X"
  crossorigin="anonymous"
/>
<Layout title={titolo}>
  <nav class="testa" id="barra">
    <TopBar />
  </nav>
  <main>
    <div class="main">
      <div class="articolo">
        <slot />
      </div>
      <div class="sideBar"><SideBarHeadings client:idle headings={astroProps.headings} /></div>
    </div>
    <div>
      {Astro.props.frontmatter.formule.length > 0 ? <TabellaSimboli simboli={Astro.props.frontmatter.formule} /> : null}
    </div>
  </main>
</Layout>

<style lang="scss">
  @import "../scss/variabili.scss";

  main {
    @include paddingGenerale;
  }

  .testa {
    position: sticky;
    top: 0;
    z-index: 999;
    background-color: white;
  }

  .main {
    padding-top: 48px;
    display: flex;
    flex-direction: row;
    justify-content: center;
    align-items: flex-start;
    // max-width: 1100px;
  }

  .sideBar {
    position: sticky;
    top: $altezzaBarra;
    padding-bottom: 100px;
    padding: $paddingContenuto 2rem;
  }

  .articolo {
    flex: 1 1 auto;
    line-height: 1.75rem;
  }

  h2,
  h3 {
    scroll-margin-top: "10%";
  }

  @media only screen and (max-width: 768px) {
    .sideBar {
      display: none;
    }
  }
</style>
